<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<script src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="<%- config.root %>js/jquery.imagesloaded.min.js"></script>
<script src="<%- config.root %>js/gallery.js"></script>
<script src="<%- config.root %>js/jquery.jruif.js"></script>
<% if (theme.fancybox){ %>
<link rel="stylesheet" href="<%- config.root %>fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="<%- config.root %>fancybox/jquery.fancybox.pack.js"></script>
<% } %>
<script type="text/javascript" src="/vegas/jquery.vegas.js"></script>
<script type="text/javascript">
(function($){
	var elem = document.createElement('canvas');
	if(!(elem.getContext && elem.getContext('2d'))){
		alert("您的浏览器不支持HTML5，页面会错乱。请选择Chrome，Firefox，IE9+以获得更好的浏览体验。");
	}
	$("h1").jruif({
		rollingLinks: true
	});
	//请求bing印象图片
	var backg=(function(num,fadeTime){
	  		var bg=[];
	  		for(var i=0;i<num;i++){
	  			bg.push({
	  				"src":"http://toolsapp.sinaapp.com/bingwp.php?idx="+Math.floor(Math.random() * 15),
	  				"fade":fadeTime
	  			});
			}
			return bg;
	  	})(5,5000);
	//vegar插件
	$.vegas('slideshow',{
	  	delay: 60000,//多久换一幅图片
		backgrounds: backg
	})( 'overlay', {
		src:'/vegas/overlay.png',
		opacity:0.6
	});
	$('.fancybox').fancybox();
	$("#pagination a").on("click", function(){
		$(this).addClass("loading");
	});
})(jQuery);
(function(){
	var canvas=document.createElement("canvas");
	canvas.id="canvas";
	canvas.width=window.innerWidth;
	canvas.height=window.innerHeight;
	canvas.style.top="0";
	canvas.style.position="fixed";
	canvas.style.zIndex=-1;
	document.body.appendChild(canvas);
    var context=canvas.getContext("2d");
    // 
    // snow
    // 
    function snow(a){
        this.name="❅";
        this.init.apply(this,arguments);
    }
    snow.staticPro=function(){
        this.canvasWidth=canvas.width;
        this.canvasHeight=canvas.height;
        this.maxSize=30;
        this.minSize=5;
        this.maxSpeed=3;
        this.minSpeed=1;
        this.minWind=0;
        this.maxWind=0.5;
        this.maxRotate=Math.PI / 4;
        this.minRotate=Math.PI / 8;
        this.color="rgba(255,255,255,1)";
        this.run=function(sn){
            var self=this,removeSnow=[];
            setInterval(function(){
                context.clearRect(0,0,self.canvasWidth,self.canvasHeight-5);
                removeSnow.forEach(function(e){
                    self.snows.splice(e,1);
                    sn.splice(e,1);
                });
                removeSnow=[];
                self.snows.forEach(function(elm,i){
                    context.fillStyle=elm.color;
                    context.font=elm.size+"px sans-serif";
                    elm.y+=elm.speed;
                    elm.x+=Math.sin((elm.wind+=0.005)*Math.PI);
                    context.fillText("❅",elm.x,elm.y);
                    if(elm.y>self.canvasHeight+elm.size||elm.x>self.canvasWidth+elm.size||elm.x<0-elm.size){
                        removeSnow.push(i);
                    }
                });
            },300/6);
        }
    }
    snow.snows=[];
    snow.prototype={
        init:function(){
            snow.staticPro();
            this.size=this.rand(snow.maxSize,snow.minSize);
            this.speed=this.rand(snow.maxSpeed,snow.minSpeed);
            this.color=this.setOpacity();
            this.wind=this.rand(snow.maxWind,snow.minWind);
            this.rotate=this.rand(snow.maxRotate,snow.minRotate);
            this.x=Math.random()*snow.canvasWidth;
            this.y=-5;
            this.createSnow(this.x,this.y,this.size);
            snow.snows.push({
                x:this.x,
                y:this.y,
                color:this.color,
                speed:this.speed,
                size:this.size,
                wind:this.wind
            });
        },
        rand:function(a,b){
            return Math.round((b - a) * Math.random()) + a;
        },
        setOpacity: function() {
            var a = (this.size - snow.minSize) / (snow.maxSize - snow.minSize);
            var b = ((0.9 - 0.1) * a + 0.1).toFixed(2);
            return snow.color.replace(/\d+(?=\)$)/g,b);
        },
        createSnow:function(x,y,size){
            context.font=this.size+"px sans-serif";
            context.fillStyle=this.color;
            context.fillText(this.name,x,y,size);
        }
    }
    var handle2=(function(dots){
        var sn=[new snow()];
        snow.run(sn);
        window.setInterval(function(sn){
            for (var i = 0; i < 5; i++) {
                sn.push(new snow());
            };
        }.bind(window,sn), 1000);
    })();
})();
</script>
<%- partial('analytics') %>